{"ast":null,"code":"var _jsxFileName = \"d:\\\\M1\\\\ecommerce-front\\\\src\\\\core\\\\Shop.js\";\nimport React, { useState, useEffect } from \"react\";\nimport Layout from \"./Layout\";\nimport Card from \"./Card\";\nimport { getCategories, getFilteredProducts } from \"./apiCore\";\nimport RadioBox from \"./RadioBox\";\nimport { prices } from \"./fixedPrices\";\nimport Checkbox from \"./Checkbox\";\n\nconst Shop = () => {\n  const [myFilters, setMyFilters] = useState({\n    filters: {\n      category: [],\n      price: []\n    }\n  });\n  const [categories, setCategories] = useState([]);\n  const [error, setError] = useState(false);\n  const [limit, setLimit] = useState(6);\n  const [skip, setSkip] = useState(0);\n  const [size, setSize] = useState(0);\n  const [filteredResults, setFilteredResults] = useState([]);\n\n  const init = () => {\n    getCategories().then(data => {\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setCategories(data);\n      }\n    });\n  };\n\n  useEffect(() => {\n    init();\n    loadFilteredResults(skip, limit, myFilters.filters);\n  }, []);\n\n  const handleFilters = (filters, filterBy) => {\n    // console.log(\"SHOP\", filters, filterBy);\n    const newFilters = { ...myFilters\n    };\n    newFilters.filters[filterBy] = filters;\n\n    if (filterBy === \"price\") {\n      let priceValues = handlePrice(filters);\n      newFilters.filters[filterBy] = priceValues;\n    }\n\n    loadFilteredResults(myFilters.filters);\n    setMyFilters(newFilters);\n  };\n\n  const loadFilteredResults = newFilters => {\n    // console.log(newFilters);\n    getFilteredProducts(skip, limit, newFilters).then(data => {\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setFilteredResults(data.data);\n        setSize(data.size);\n        setSkip(0);\n      }\n    });\n  };\n\n  const loadMore = () => {\n    let toSkip = skip + limit; // console.log(newFilters);\n\n    getFilteredProducts(toSkip, limit, myFilters.filters).then(data => {\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setFilteredResults([...filteredResults, ...data.data]);\n        setSize(data.size);\n        setSkip(toSkip);\n      }\n    });\n  };\n\n  const loadMoreButton = () => {\n    return size > 0 && size >= limit && React.createElement(\"button\", {\n      onClick: loadMore,\n      className: \"btn btn-warning mb-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }, \"Load more\");\n  };\n\n  const handlePrice = value => {\n    const data = prices;\n    let array = [];\n\n    for (let key in data) {\n      if (data[key]._id === parseInt(value)) {\n        array = data[key].array;\n      }\n    }\n\n    return array;\n  };\n\n  return React.createElement(Layout, {\n    title: \"Shop Page\",\n    description: \"Search and find books of your choice\",\n    className: \"container-fluid\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, React.createElement(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, \"Filter by categories\"), React.createElement(\"ul\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(Checkbox, {\n    categories: categories,\n    handleFilters: filters => handleFilters(filters, \"category\"),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  })), React.createElement(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, \"Filter by price range\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(RadioBox, {\n    prices: prices,\n    handleFilters: filters => handleFilters(filters, \"price\"),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"col-8\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    className: \"mb-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, \"Products\"), React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, filteredResults.map((product, i) => React.createElement(\"div\", {\n    key: i,\n    className: \"col-4 mb-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(Card, {\n    product: product,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  })))), React.createElement(\"hr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }), loadMoreButton())));\n};\n\nexport default Shop;","map":{"version":3,"sources":["d:/M1/ecommerce-front/src/core/Shop.js"],"names":["React","useState","useEffect","Layout","Card","getCategories","getFilteredProducts","RadioBox","prices","Checkbox","Shop","myFilters","setMyFilters","filters","category","price","categories","setCategories","error","setError","limit","setLimit","skip","setSkip","size","setSize","filteredResults","setFilteredResults","init","then","data","loadFilteredResults","handleFilters","filterBy","newFilters","priceValues","handlePrice","loadMore","toSkip","loadMoreButton","value","array","key","_id","parseInt","map","product","i"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,SAASC,aAAT,EAAwBC,mBAAxB,QAAmD,WAAnD;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,SAASC,MAAT,QAAuB,eAAvB;AACA,OAAOC,QAAP,MAAqB,YAArB;;AACA,MAAMC,IAAI,GAAG,MAAM;AACf,QAAM,CAACC,SAAD,EAAYC,YAAZ,IAA4BX,QAAQ,CAAC;AACvCY,IAAAA,OAAO,EAAE;AAAEC,MAAAA,QAAQ,EAAE,EAAZ;AAAgBC,MAAAA,KAAK,EAAE;AAAvB;AAD8B,GAAD,CAA1C;AAGA,QAAM,CAACC,UAAD,EAAaC,aAAb,IAA8BhB,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAACiB,KAAD,EAAQC,QAAR,IAAoBlB,QAAQ,CAAC,KAAD,CAAlC;AACA,QAAM,CAACmB,KAAD,EAAQC,QAAR,IAAoBpB,QAAQ,CAAC,CAAD,CAAlC;AACA,QAAM,CAACqB,IAAD,EAAOC,OAAP,IAAkBtB,QAAQ,CAAC,CAAD,CAAhC;AACA,QAAM,CAACuB,IAAD,EAAOC,OAAP,IAAkBxB,QAAQ,CAAC,CAAD,CAAhC;AACA,QAAM,CAACyB,eAAD,EAAkBC,kBAAlB,IAAwC1B,QAAQ,CAAC,EAAD,CAAtD;;AAEA,QAAM2B,IAAI,GAAG,MAAM;AACfvB,IAAAA,aAAa,GAAGwB,IAAhB,CAAqBC,IAAI,IAAI;AACzB,UAAIA,IAAI,CAACZ,KAAT,EAAgB;AACZC,QAAAA,QAAQ,CAACW,IAAI,CAACZ,KAAN,CAAR;AACH,OAFD,MAEO;AACHD,QAAAA,aAAa,CAACa,IAAD,CAAb;AACH;AACJ,KAND;AAOH,GARD;;AAUA5B,EAAAA,SAAS,CAAC,MAAM;AACZ0B,IAAAA,IAAI;AACJG,IAAAA,mBAAmB,CAACT,IAAD,EAAOF,KAAP,EAAcT,SAAS,CAACE,OAAxB,CAAnB;AACH,GAHQ,EAGN,EAHM,CAAT;;AAKA,QAAMmB,aAAa,GAAG,CAACnB,OAAD,EAAUoB,QAAV,KAAuB;AACzC;AACA,UAAMC,UAAU,GAAG,EAAE,GAAGvB;AAAL,KAAnB;AACAuB,IAAAA,UAAU,CAACrB,OAAX,CAAmBoB,QAAnB,IAA+BpB,OAA/B;;AAEA,QAAIoB,QAAQ,KAAK,OAAjB,EAA0B;AACtB,UAAIE,WAAW,GAAGC,WAAW,CAACvB,OAAD,CAA7B;AACAqB,MAAAA,UAAU,CAACrB,OAAX,CAAmBoB,QAAnB,IAA+BE,WAA/B;AACH;;AACDJ,IAAAA,mBAAmB,CAACpB,SAAS,CAACE,OAAX,CAAnB;AACAD,IAAAA,YAAY,CAACsB,UAAD,CAAZ;AACH,GAXD;;AAaA,QAAMH,mBAAmB,GAAGG,UAAU,IAAI;AACtC;AACA5B,IAAAA,mBAAmB,CAACgB,IAAD,EAAOF,KAAP,EAAcc,UAAd,CAAnB,CAA6CL,IAA7C,CAAkDC,IAAI,IAAI;AACtD,UAAIA,IAAI,CAACZ,KAAT,EAAgB;AACZC,QAAAA,QAAQ,CAACW,IAAI,CAACZ,KAAN,CAAR;AACH,OAFD,MAEO;AACHS,QAAAA,kBAAkB,CAACG,IAAI,CAACA,IAAN,CAAlB;AACAL,QAAAA,OAAO,CAACK,IAAI,CAACN,IAAN,CAAP;AACAD,QAAAA,OAAO,CAAC,CAAD,CAAP;AACH;AACJ,KARD;AASH,GAXD;;AAaA,QAAMc,QAAQ,GAAG,MAAM;AACnB,QAAIC,MAAM,GAAGhB,IAAI,GAAGF,KAApB,CADmB,CAEnB;;AACAd,IAAAA,mBAAmB,CAACgC,MAAD,EAASlB,KAAT,EAAgBT,SAAS,CAACE,OAA1B,CAAnB,CAAsDgB,IAAtD,CAA2DC,IAAI,IAAI;AAC/D,UAAIA,IAAI,CAACZ,KAAT,EAAgB;AACZC,QAAAA,QAAQ,CAACW,IAAI,CAACZ,KAAN,CAAR;AACH,OAFD,MAEO;AACHS,QAAAA,kBAAkB,CAAC,CAAC,GAAGD,eAAJ,EAAqB,GAAGI,IAAI,CAACA,IAA7B,CAAD,CAAlB;AACAL,QAAAA,OAAO,CAACK,IAAI,CAACN,IAAN,CAAP;AACAD,QAAAA,OAAO,CAACe,MAAD,CAAP;AACH;AACJ,KARD;AASH,GAZD;;AAcH,QAAMC,cAAc,GAAG,MAAM;AACtB,WACIf,IAAI,GAAG,CAAP,IACAA,IAAI,IAAIJ,KADR,IAEI;AAAQ,MAAA,OAAO,EAAEiB,QAAjB;AAA2B,MAAA,SAAS,EAAC,sBAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAHR;AAQH,GATJ;;AAWG,QAAMD,WAAW,GAAGI,KAAK,IAAI;AACzB,UAAMV,IAAI,GAAGtB,MAAb;AACA,QAAIiC,KAAK,GAAG,EAAZ;;AAEA,SAAK,IAAIC,GAAT,IAAgBZ,IAAhB,EAAsB;AAClB,UAAIA,IAAI,CAACY,GAAD,CAAJ,CAAUC,GAAV,KAAkBC,QAAQ,CAACJ,KAAD,CAA9B,EAAuC;AACnCC,QAAAA,KAAK,GAAGX,IAAI,CAACY,GAAD,CAAJ,CAAUD,KAAlB;AACH;AACJ;;AACD,WAAOA,KAAP;AACH,GAVD;;AAaA,SACI,oBAAC,MAAD;AACI,IAAA,KAAK,EAAC,WADV;AAEI,IAAA,WAAW,EAAC,sCAFhB;AAGI,IAAA,SAAS,EAAC,iBAHd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKI;AAAK,IAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AAAK,IAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADJ,EAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,QAAD;AACI,IAAA,UAAU,EAAEzB,UADhB;AAEI,IAAA,aAAa,EAAEH,OAAO,IACtBmB,aAAa,CAACnB,OAAD,EAAU,UAAV,CAHjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CAFJ,EAWI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAXJ,EAYI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,QAAD;AACI,IAAA,MAAM,EAAEL,MADZ;AAEI,IAAA,aAAa,EAAEK,OAAO,IAClBmB,aAAa,CAACnB,OAAD,EAAU,OAAV,CAHrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CAZJ,CADJ,EAuBI;AAAK,IAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AAAI,IAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,EAEI;AAAK,IAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKa,eAAe,CAACmB,GAAhB,CAAoB,CAACC,OAAD,EAAUC,CAAV,KACjB;AAAK,IAAA,GAAG,EAAEA,CAAV;AAAa,IAAA,SAAS,EAAC,YAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACA,oBAAC,IAAD;AAAM,IAAA,OAAO,EAAED,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADA,CADH,CADL,CAFJ,EASI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IATJ,EAUKP,cAAc,EAVnB,CAvBJ,CALJ,CADJ;AA4CH,CAtID;;AAwIA,eAAe7B,IAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Layout from \"./Layout\";\r\nimport Card from \"./Card\";\r\nimport { getCategories, getFilteredProducts } from \"./apiCore\";\r\nimport RadioBox from \"./RadioBox\";\r\nimport { prices } from \"./fixedPrices\";\r\nimport Checkbox from \"./Checkbox\";\r\nconst Shop = () => {\r\n    const [myFilters, setMyFilters] = useState({\r\n        filters: { category: [], price: [] }\r\n    });\r\n    const [categories, setCategories] = useState([]);\r\n    const [error, setError] = useState(false);\r\n    const [limit, setLimit] = useState(6);\r\n    const [skip, setSkip] = useState(0);\r\n    const [size, setSize] = useState(0);\r\n    const [filteredResults, setFilteredResults] = useState([]);\r\n   \r\n    const init = () => {\r\n        getCategories().then(data => {\r\n            if (data.error) {\r\n                setError(data.error);\r\n            } else {\r\n                setCategories(data);\r\n            }\r\n        }); \r\n    }; \r\n    \r\n    useEffect(() => {\r\n        init();\r\n        loadFilteredResults(skip, limit, myFilters.filters);\r\n    }, []);\r\n\r\n    const handleFilters = (filters, filterBy) => {\r\n        // console.log(\"SHOP\", filters, filterBy);\r\n        const newFilters = { ...myFilters };\r\n        newFilters.filters[filterBy] = filters;\r\n\r\n        if (filterBy === \"price\") {\r\n            let priceValues = handlePrice(filters);\r\n            newFilters.filters[filterBy] = priceValues;\r\n        }\r\n        loadFilteredResults(myFilters.filters);\r\n        setMyFilters(newFilters);\r\n    };\r\n\r\n    const loadFilteredResults = newFilters => {\r\n        // console.log(newFilters);\r\n        getFilteredProducts(skip, limit, newFilters).then(data => {\r\n            if (data.error) {\r\n                setError(data.error);\r\n            } else {\r\n                setFilteredResults(data.data);\r\n                setSize(data.size);\r\n                setSkip(0);\r\n            }\r\n        });\r\n    };\r\n\r\n    const loadMore = () => {\r\n        let toSkip = skip + limit;\r\n        // console.log(newFilters);\r\n        getFilteredProducts(toSkip, limit, myFilters.filters).then(data => {\r\n            if (data.error) {\r\n                setError(data.error);\r\n            } else {\r\n                setFilteredResults([...filteredResults, ...data.data]);\r\n                setSize(data.size);\r\n                setSkip(toSkip);\r\n            }\r\n        });\r\n    };\r\n\r\n const loadMoreButton = () => {\r\n        return (\r\n            size > 0 &&\r\n            size >= limit && (\r\n                <button onClick={loadMore} className=\"btn btn-warning mb-5\">\r\n                    Load more\r\n                </button>\r\n            )\r\n        );\r\n    };\r\n\r\n    const handlePrice = value => {\r\n        const data = prices;\r\n        let array = [];\r\n\r\n        for (let key in data) {\r\n            if (data[key]._id === parseInt(value)) {\r\n                array = data[key].array;\r\n            }\r\n        }\r\n        return array;\r\n    };\r\n\r\n\r\n    return (\r\n        <Layout\r\n            title=\"Shop Page\"\r\n            description=\"Search and find books of your choice\"\r\n            className=\"container-fluid\"\r\n        >\r\n            <div className=\"row\">\r\n                <div className=\"col-4\">\r\n                    <h4>Filter by categories</h4>\r\n                    <ul>\r\n                        <Checkbox\r\n                            categories={categories}\r\n                            handleFilters={filters =>\r\n                            handleFilters(filters, \"category\")\r\n                            }\r\n                        />\r\n                    </ul>\r\n\r\n                    <h4>Filter by price range</h4>\r\n                    <div>\r\n                        <RadioBox\r\n                            prices={prices}\r\n                            handleFilters={filters =>\r\n                                handleFilters(filters, \"price\")\r\n                            }\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"col-8\">\r\n                    <h2 className=\"mb-4\">Products</h2>\r\n                    <div className=\"row\">\r\n                        {filteredResults.map((product, i) => (\r\n                            <div key={i} className=\"col-4 mb-3\">\r\n                            <Card product={product} />\r\n                        </div>\r\n                        ))}\r\n                    </div>\r\n                    <hr />\r\n                    {loadMoreButton()}\r\n                </div>\r\n            </div>\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default Shop;\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}